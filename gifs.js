/*
https://onlinegiftools.com/
*/

var GIFS=function(t={}){var e=void 0!==t?t:{};return function(t){e.dec=t;var r=t.GifBlock={EXTENSION:33,IMAGE:44,TERMINATOR:59},a=t.GifExtension={PLAIN_TEXT:1,GRAPHICS_CONTROL:249,COMMENT:254,APPLICATION:255},n=t.GifCompression={MAX_BITS:12,MAX_CODES:4096,MAX_STACK_SIZE:4097,NULL_CODE:51914},i=t.GifDisposal={UNSPECIFIED:0,NONE:1,BACKGROUND:2,PREVIOUS:3,COUNT:4},o=t.GifHeader=function(){this.version=0};o.LENGTH=6;var s=t.GifScreenDescriptor=function(){this.width=0,this.height=0,this.globalColors=null,this.backgroundIndex=0,this.aspect=0};s.GLOBAL_COLOR=128,s.DEPTH_MASK=7,s.LENGTH=7;var l=t.NetscapeApp=function(){this.name="NETSCAPE2.0",this.repetitions=0},c=t.UnknownApp=function(){this.name=""},h=t.GifGraphicsControl=function(){this.delay=0,this.isTransparent=!1,this.transparencyIndex=!1,this.disposal=i.UNSPECIFIED};h.TRANSPARENCY=1,h.DISPOSAL_MASK=28,h.DISPOSAL_SHIFT=2,h.LENGTH=5;var f=t.GifImageDescriptor=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.localColors=null,this.interlace=!1};f.LOCAL_COLOR=128,f.INTERLACE=64,f.DEPTH_MASK=7,f.LENGTH=9;var u=t.GifFrame=function(){this.graphicsControl=null,this.imageDescriptor=null,this.indexData=null,this.canvas=null,this.context=null},d=t.GifImage=function(){this.header=null,this.screenDescriptor=null,this.frames=[],this.repetitions=null},p=function(t,e,r,a){var n=r.imageDescriptor.x,o=r.imageDescriptor.y,s=r.imageDescriptor.width,l=r.imageDescriptor.height,c=!!r.graphicsControl&&r.graphicsControl.isTransparent,h=r.graphicsControl?r.graphicsControl.transparencyIndex:0,f=r.indexData,u=a.context.getImageData(0,0,a.canvas.width,a.canvas.height);switch(r.graphicsControl?r.graphicsControl.disposal:i.UNSPECIFIED){case i.BACKGROUND:for(var d=0;d<l;d++)for(var p=0;p<s;p++)if(!c||f[d*s+p]!==h){var g=o+d;if((w=n+p)<0||w>=u.width||g<0||g>=u.height)continue;var v=4*(g*u.width+w);u.data[v+0]=0,u.data[v+1]=0,u.data[v+2]=0,u.data[v+3]=0}a.canvas.getContext("2d").putImageData(u,0,0);break;case i.PREVIOUS:var m=null!==e?e.context.getImageData(0,0,e.canvas.width,e.canvas.height):null;for(d=0;d<l;d++)for(p=0;p<s;p++)if(!c||f[d*s+p]!==h){var w;if(g=o+d,(w=n+p)<0||w>=u.width||g<0||g>=u.height)continue;v=4*(g*u.width+w),m?(u.data[v+0]=m.data[v+0],u.data[v+1]=m.data[v+1],u.data[v+2]=m.data[v+2],u.data[v+3]=m.data[v+3]):(u.data[v+0]=0,u.data[v+1]=0,u.data[v+2]=0,u.data[v+3]=0)}a.context.putImageData(u,0,0)}};function g(t,e){for(var r=e.imageDescriptor.localColors||t.globalColors,a=e.imageDescriptor.x,n=e.imageDescriptor.y,i=e.imageDescriptor.width,o=e.imageDescriptor.height,s=!!e.graphicsControl&&e.graphicsControl.isTransparent,l=e.graphicsControl?e.graphicsControl.transparencyIndex:0,c=e.indexData,h=e.context.getImageData(0,0,e.canvas.width,e.canvas.height),f=0;f<o;f++)for(var u=0;u<i;u++){var d=c[f*i+u];if(!(d<0||d>=r.length||s&&d===l)){var p=a+u,g=n+f;if(p<0||p>=h.width||g<0||g>=h.height)continue;d*=4;var v=4*(g*h.width+p);h.data[v+0]=r[d+0],h.data[v+1]=r[d+1],h.data[v+2]=r[d+2],h.data[v+3]=r[d+3]}}e.context.putImageData(h,0,0)}d.prototype.renderFrames=function(){for(var t=this.frames,e=0;e<t.length;e++){var r=document.createElement("canvas");r.width=this.screenDescriptor.width,r.height=this.screenDescriptor.height,t[e].canvas=r,t[e].context=r.getContext("2d")}var a=null,n=null;for(e=0;e<t.length;e++){var o=t[e];if(null===n?o.context.clearRect(0,0,o.canvas.width,o.canvas.height):(o.context.drawImage(n.canvas,0,0),p(this.screenDescriptor,a,n,o)),g(this.screenDescriptor,o),null!==n){var s=n.graphicsControl?n.graphicsControl.disposal:i.UNSPECIFIED;(s===i.NONE||s===i.UNSPECIFIED)&&(a=n)}n=o}};var v=t.GifReader=function(t){this.buffer=t,this.position=0,this.prefixCodes=new Array(n.MAX_CODES),this.suffixChars=new Array(n.MAX_CODES),this.charStack=new Array(n.MAX_STACK_SIZE),this.onerror=function(t){}};v.prototype.readHeader=function(){var t=this.buffer,e=this.position;if(e+o.LENGTH>=t.length)return this.onerror("invalid GIF header (encountered early end of stream)"),null;var r=String.fromCharCode.apply(null,Array.prototype.slice.call(t,e,e+o.LENGTH));if(e+=o.LENGTH,this.position=e,"GIF87a"!==r&&"GIF89a"!==r)return this.onerror("invalid GIF header (invalid version signature)"),null;var a=new o;return a.version=+r.substr(3,2),a},v.prototype.readScreenDescriptor=function(){var t=this.buffer,e=this.position;if(e+s.LENGTH>=t.length)return this.onerror("invalid screen descriptor (encountered early end of stream)"),null;var r=new s;r.width=t[e]|t[e+1]<<8,e+=2,r.height=t[e]|t[e+1]<<8;var a=t[e+=2];return e++,a&s.GLOBAL_COLOR&&(r.globalColors=new Uint8Array(4*(1<<1+(a&s.DEPTH_MASK)))),r.backgroundIndex=t[e],e++,r.aspect=t[e],e++,this.position=e,r},v.prototype.readGraphicsControl=function(){var t=this.buffer,e=this.position;if(e+h.LENGTH>=t.length)return this.onerror("invalid graphics control block (encountered early end of stream)"),null;var r=new h,a=t[e];if(e++,a!==h.LENGTH-1)return this.onerror("invalid graphics control block (block size does not match GIF specification)"),null;var n=t[e];return e++,r.isTransparent=0!=(n&h.TRANSPARENCY),r.disposal=(n&h.DISPOSAL_MASK)>>h.DISPOSAL_SHIFT,r.disposal>=i.COUNT&&(r.disposal=i.UNSPECIFIED),r.delay=t[e]|t[e+1]<<8,e+=2,r.transparencyIndex=t[e],e++,this.position=e,this.skipSubBlocks()?r:null},v.prototype.readApplication=function(){var t=this.buffer,e=this.position,r=t[e];if(e+r>=t.length)return this.onerror("invalid application extension block (encountered early end of stream)"),null;e++;var a=String.fromCharCode.apply(null,Array.prototype.slice.call(t,e,e+r));if(e+=r,"NETSCAPE2.0"==a){var n=t[e];if(3!=n)return this.onerror("invalid netscape2.0 sublock size (should be 3 but was "+n+")"),null;var i=t[++e];if(1!=i)return this.onerror("invalid netscape2.0 sublock id (should be 1 but was "+i+")"),null;var o,s=t[++e]|t[e+1]<<8;return e+=2,e++,this.position=e,(o=new l).repetitions=s,o}return this.skipSubBlocks()?((o=new c).name=a,o):null},v.prototype.readImageDescriptor=function(){var t=this.buffer,e=this.position;if(e+f.LENGTH>=t.length)return this.onerror("invalid image descriptor (encountered early end of stream)"),null;var r=new f;r.x=t[e]|t[e+1]<<8,e+=2,r.y=t[e]|t[e+1]<<8,e+=2,r.width=t[e]|t[e+1]<<8,e+=2,r.height=t[e]|t[e+1]<<8;var a=t[e+=2];return e++,a&f.LOCAL_COLOR&&(r.localColors=new Uint8Array(4*(1<<1+(a&f.DEPTH_MASK)))),r.interlace=0!=(a&f.INTERLACE),this.position=e,r},v.prototype.readPalette=function(t){var e=this.buffer,r=this.position;if(r+t.length/4>=e.length)return this.onerror("invalid palette data (encountered early end of stream)"),!1;var a=t.length;for(j=0;j<a;j+=4,r+=3)t[j+0]=e[r+0],t[j+1]=e[r+1],t[j+2]=e[r+2],t[j+3]=255;return this.position=r,!0},v.prototype.skipSubBlocks=function(){var t=this.buffer,e=this.position;do{if(e>=t.length)return this.onerror("invalid sub block (encountered early end of stream)"),!1;var r=t[e++];if(e+r>=t.length)return this.onerror("invalid sub block (encountered early end of stream)"),!1;e+=r}while(r>0);return this.position=e,!0},v.prototype.readFrame=function(t){var e=this.position,r=this.buffer;if(e>=r.length)return this.onerror("invalid frame data (encountered early end of stream)"),!1;var a=r[e++];if(a>n.MAX_BITS)return this.onerror("invalid frame data (minimum code requires more bits than permitted by GIF specification)"),!1;for(var i=1<<a,o=i+1,s=a+1,l=(1<<s)-1,c=o+1,h=n.NULL_CODE,f=this.prefixCodes,u=this.suffixChars,d=this.charStack,p=0;p<i;p++)f[p]=n.NULL_CODE,u[p]=255&p;for(var g=0,v=0,m=0,w=0,y=0,C=0,D=0,I=t.imageDescriptor.interlace?3:0,A=t.imageDescriptor.interlace?8:1;;)if(m<s){if(0===v){if(e>=r.length)return this.onerror("invalid frame data (encountered early end of stream)"),!1;if(0===(v=r[e++]))return this.position=e,!0}if(e>=r.length)return this.onerror("invalid frame data (encountered early end of stream)"),!1;w|=r[e++]<<m,m+=8,v--}else{var E=w&l;if(w>>=s,m-=s,E===i)l=(1<<(s=a+1))-1,c=o+1,h=n.NULL_CODE;else{if(E===o)return e+v>=r.length?(this.onerror("invalid frame data (encountered early end of stream)"),!1):(e+=v,this.position=e,this.skipSubBlocks());if(h===n.NULL_CODE){if(E>=n.MAX_CODES||g>=n.MAX_STACK_SIZE)return this.onerror("invalid frame data (character stack overflow)"),!1;d[g++]=u[E],y=255&E,h=E}else{if(!(E<=c))return this.onerror("invalid frame data (invalid code encountered)"),!1;var b=E;if(b===c){if(g>=n.MAX_STACK_SIZE)return this.onerror("invalid frame data (character stack overflow)"),!1;d[g++]=y,b=h}for(;b>=i;){if(b>=n.MAX_CODES)return this.onerror("invalid frame data (exhausted available prefix codes)"),!1;if(g>=n.MAX_STACK_SIZE)return this.onerror("invalid frame data (character stack overflow)"),!1;d[g++]=u[b],b=f[b]}if(y=u[b],g>=n.MAX_STACK_SIZE)return this.onerror("invalid frame data (character stack overflow)"),!1;d[g++]=y,c<n.MAX_CODES&&(f[c]=h,u[c]=y,!(++c&l)&&c<n.MAX_CODES&&(l=(1<<++s)-1)),h=E}}for(var S=t.indexData,N=t.imageDescriptor.width,T=t.imageDescriptor.height;g>0&&!(D>=T);){var B=d[--g];S[D*N+C]=B,++C>=N&&(C=0,(D+=A)>=T&&I>0&&(D=(A=1<<I)>>>1,I--))}}},v.prototype.read=function(){var t=new d,e=this.readHeader();if(!e)return null;t.header=e;var n=this.readScreenDescriptor();if(!n||null!==n.globalColors&&!this.readPalette(n.globalColors))return null;t.screenDescriptor=n;for(var i=null;;){if(this.position>=this.buffer.length)return null;switch(this.buffer[this.position++]){case r.EXTENSION:if(this.position>=this.buffer.length)return null;switch(this.buffer[this.position++]){case a.APPLICATION:var o=this.readApplication();if(!o)return null;"NETSCAPE2.0"==o.name&&(t.repetitions=o.repetitions);break;case a.GRAPHICS_CONTROL:if(!(i=this.readGraphicsControl()))return null;break;default:if(!this.skipSubBlocks())return null}break;case r.IMAGE:var s=this.readImageDescriptor();if(!s||null!==s.localColors&&!this.readPalette(s.localColors))return null;var l=new u;if(l.graphicsControl=i,l.imageDescriptor=s,l.palette=s.localColors||n.globalColors,l.indexData=new Uint8Array(s.width*s.height),!this.readFrame(l))return null;t.frames.push(l);break;case r.TERMINATOR:return t}}},t.load=function(e){for(var r=e.files,a=e.raw||!1,n=e.oncomplete||function(){},i=e.onerror||function(t,e){},o=new Array(r.length),s=r.length,l=0;l<r.length;l++)!function(e){var l=r[e],c=new FileReader;c.onload=function(r){var c=new t.GifReader(new Uint8Array(r.target.result));c.onerror=function(t){i(l,t)};var h=c.read();h&&(a||h.renderFrames(),o[e]=h,0==--s&&n(o))},c.readAsArrayBuffer(l)}(l);for(r=e.buffers,a=e.raw||!1,n=e.oncomplete||function(){},i=e.onerror||function(t,e){},o=new Array(r.length),s=r.length,l=0;l<r.length;l++)!function(e){const l=r[e],c=new t.GifReader(new Uint8Array(l));c.onerror=function(t){i(E,t)};var h=c.read();h&&(a||h.renderFrames(),o[e]=h,0==--s&&n(o))}(l)}}({}),LZWEncoder=function(){var t,e,r,a,n,i,o,s,l,c,h,f,u={},d=[],p=[],g=5003,v=0,m=!1,w=0,y=0,C=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],D=[],I=u.LZWEncoder=function(n,i,o,s){t=n,e=i,r=o,a=Math.max(2,s)},A=function(t,e){D[f++]=t,f>=254&&N(e)},E=function(t){b(g),v=c+2,m=!0,L(c,t)},b=function(t){for(var e=0;e<t;++e)d[e]=-1},S=u.compress=function(t,e){var r,a,n,i,u,w,y;for(m=!1,s=T(o=l=t),h=1+(c=1<<t-1),v=c+2,f=0,i=B(),y=0,r=g;r<65536;r*=2)++y;y=8-y,b(w=g),L(c,e);t:for(;-1!=(n=B());)if(r=(n<<12)+i,d[a=n<<y^i]!=r){if(d[a]>=0){u=w-a,0===a&&(u=1);do{if((a-=u)<0&&(a+=w),d[a]==r){i=p[a];continue t}}while(d[a]>=0)}L(i,e),i=n,v<4096?(p[a]=v++,d[a]=r):E(e)}else i=p[a];L(i,e),L(h,e)},N=(u.encode=function(r){r.writeByte(a),n=t*e,i=0,S(a+1,r),r.writeByte(0)},function(t){f>0&&(t.writeByte(f),t.writeBytes(D,0,f),f=0)}),T=function(t){return(1<<t)-1},B=function(){return 0===n?-1:(--n,255&r[i++])},L=function(t,e){for(w&=C[y],y>0?w|=t<<y:w=t,y+=o;y>=8;)A(255&w,e),w>>=8,y-=8;if((v>s||m)&&(m?(s=T(o=l),m=!1):(++o,s=12==o?4096:T(o))),t==h){for(;y>0;)A(255&w,e),w>>=8,y-=8;N(e)}};return I.apply(this,arguments),u},NeuQuant=function(){var t,e,r,a,n,i={},o=256,s=1024,l=1<<18,c=[],h=[],f=[],u=[],d=i.NeuQuant=function(t,i,s){var l,c;for(e=t,r=i,a=s,n=new Array(o),l=0;l<o;l++)n[l]=new Array(4),(c=n[l])[0]=c[1]=c[2]=(l<<12)/o,f[l]=256,h[l]=0},p=(i.map=function(t,e,r){var a,i,s,l,h,f,u;for(h=1e3,u=-1,i=(a=c[e])-1;a<o||i>=0;)a<o&&((s=(f=n[a])[1]-e)>=h?a=o:(a++,s<0&&(s=-s),(l=f[0]-t)<0&&(l=-l),(s+=l)<h&&((l=f[2]-r)<0&&(l=-l),(s+=l)<h&&(h=s,u=f[3])))),i>=0&&((s=e-(f=n[i])[1])>=h?i=-1:(i--,s<0&&(s=-s),(l=f[0]-t)<0&&(l=-l),(s+=l)<h&&((l=f[2]-r)<0&&(l=-l),(s+=l)<h&&(h=s,u=f[3]))));return u},i.process=function(){return function(){var n,i,o,l,c,h,f,d,p,w,y,C,D,I;for(r<1509&&(a=1),t=30+(a-1)/3,C=e,D=0,I=r,w=(y=r/(3*a))/100|0,d=s,(f=(h=2048)>>6)<=1&&(f=0),n=0;n<f;n++)u[n]=d*(256*(f*f-n*n)/(f*f));for(p=r<1509?3:r%499!=0?1497:r%491!=0?1473:r%487!=0?1461:1509,n=0;n<y;)if(o=(255&C[D+0])<<4,l=(255&C[D+1])<<4,c=(255&C[D+2])<<4,i=m(o,l,c),v(d,i,o,l,c),0!==f&&g(f,i,o,l,c),(D+=p)>=I&&(D-=r),0===w&&(w=1),++n%w==0)for(d-=d/t,(f=(h-=h/30)>>6)<=1&&(f=0),i=0;i<f;i++)u[i]=d*(256*(f*f-i*i)/(f*f))}(),p(),function(){var t,e,r,a,i,s,l,h;for(l=0,h=0,t=0;t<o;t++){for(r=t,a=(i=n[t])[1],e=t+1;e<o;e++)(s=n[e])[1]<a&&(r=e,a=s[1]);if(s=n[r],t!=r&&(e=s[0],s[0]=i[0],i[0]=e,e=s[1],s[1]=i[1],i[1]=e,e=s[2],s[2]=i[2],i[2]=e,e=s[3],s[3]=i[3],i[3]=e),a!=l){for(c[l]=h+t>>1,e=l+1;e<a;e++)c[e]=t;l=a,h=t}}for(c[l]=h+255>>1,e=l+1;e<256;e++)c[e]=255}(),function(){for(var t=[],e=new Array(o),r=0;r<o;r++)e[n[r][3]]=r;for(var a=0,i=0;i<o;i++){var s=e[i];t[a++]=n[s][0],t[a++]=n[s][1],t[a++]=n[s][2]}return t}()},function(){var t;for(t=0;t<o;t++)n[t][0]>>=4,n[t][1]>>=4,n[t][2]>>=4,n[t][3]=t}),g=function(t,e,r,a,i){var s,c,h,f,d,p,g;for((h=e-t)<-1&&(h=-1),(f=e+t)>o&&(f=o),s=e+1,c=e-1,p=1;s<f||c>h;){if(d=u[p++],s<f){g=n[s++];try{g[0]-=d*(g[0]-r)/l,g[1]-=d*(g[1]-a)/l,g[2]-=d*(g[2]-i)/l}catch(t){}}if(c>h){g=n[c--];try{g[0]-=d*(g[0]-r)/l,g[1]-=d*(g[1]-a)/l,g[2]-=d*(g[2]-i)/l}catch(t){}}}},v=function(t,e,r,a,i){var o=n[e];o[0]-=t*(o[0]-r)/s,o[1]-=t*(o[1]-a)/s,o[2]-=t*(o[2]-i)/s},m=function(t,e,r){var a,i,s,l,c,u,d,p,g,v;for(g=p=~(1<<31),d=u=-1,a=0;a<o;a++)(i=(v=n[a])[0]-t)<0&&(i=-i),(s=v[1]-e)<0&&(s=-s),i+=s,(s=v[2]-r)<0&&(s=-s),(i+=s)<p&&(p=i,u=a),(l=i-(h[a]>>12))<g&&(g=l,d=a),c=f[a]>>10,f[a]-=c,h[a]+=c<<10;return f[u]+=64,h[u]-=65536,d};return d.apply(this,arguments),i},e.enc=function(){for(var t=0,e={};t<256;t++)e[t]=String.fromCharCode(t);function r(){this.bin=[]}r.prototype.toDataURL=function(){for(var t,e,r,a,n,i,o,s=this.getData(),l="",c=0,h=s.length,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c<h;)a=(t=s.charCodeAt(c++))>>2,n=(3&t)<<4|(e=s.charCodeAt(c++))>>4,i=(15&e)<<2|(r=s.charCodeAt(c++))>>6,o=63&r,isNaN(e)?i=o=64:isNaN(r)&&(o=64),l=l+f.charAt(a)+f.charAt(n)+f.charAt(i)+f.charAt(o);return"data:image/gif;base64,"+l},r.prototype.getData=function(){for(var t="",r=this.bin.length,a=0;a<r;a++)t+=e[this.bin[a]];return t},r.prototype.writeByte=function(t){this.bin.push(t)},r.prototype.writeUTFBytes=function(t){for(var e=t.length,r=0;r<e;r++)this.writeByte(t.charCodeAt(r))},r.prototype.writeBytes=function(t,e,r){for(var a=r||t.length,n=e||0;n<a;n++)this.writeByte(t[n])};var a,n,i,o,s,l,c,h,f,u={},d=null,p=null,g=null,v=-1,m=0,w=!1,y=[],C=7,D=-1,I=!1,A=!0,E=!1,b=10,S="Generated by onlineGIFtools.com",N=(u.setDelay=function(t){m=Math.round(t/10)},u.setDispose=function(t){t>=0&&(D=t)},u.setRepeat=function(t){t>=0&&(v=t)},u.setTransparent=function(t){g=t},u.setComment=function(t){S=t},u.addFrame=function(t,e,r,i,l,c,h){var f=0,u=0;if(void 0!==c&&(f=c),void 0!==h&&(u=h),void 0!==i&&(a=i),void 0!==l&&(n=l),null===t||!w||null===o)throw new Error("Please call start method before calling addFrame");var d=!0;try{e?t instanceof ImageData?(s=t.data,(!E||a!=t.width||n!=t.height)&&T(t.width,t.height)):t instanceof Uint8ClampedArray?t.length==a*n*4?s=t:(console.log("Please set the correct size: ImageData length mismatch"),d=!1):(console.log("Please provide correct input"),d=!1):(s=t.getImageData(0,0,t.canvas.width,t.canvas.height).data,E||T(t.canvas.width,t.canvas.height)),x(),B(r),A&&(k(),P(),v>=0&&_()),F(),""!==S&&G(),M(f,u),A||P(),U(),A=!1}catch(t){d=!1}return d},u.addFrameRaw=function(t,e,r,s,l,u,d,p){if(c=e,g=!!r||null,i=s,a=l,n=u,!w||null===o)throw new Error("Please call start method before calling addFrame");var m=!0;try{h=8,C=7,f=[];for(var y=0;y<t.length;y+=4)f.push(t[y+0]),f.push(t[y+1]),f.push(t[y+2]);A&&(k(),P(),v>=0&&_()),F(),""!==S&&G(),M(d,p),A||P(),U(),A=!1}catch(t){m=!1}return m},u.download=function(t){if(null===o||0==I)console.log("Please call start method and add frames and call finish method before calling download");else{t=void 0!==t?t.endsWith(".gif")?t:t+".gif":"download.gif";var e=document.createElement("a");e.download=t,e.href=URL.createObjectURL(new Blob([new Uint8Array(o.bin)],{type:"image/gif"})),e.click()}},u.toBlob=function(t){if(null!==o&&0!=I)return new Blob([new Uint8Array(o.bin)],{type:"image/gif"});console.log("Please call start method and add frames and call finish method before calling download")},u.finish=function(){if(!w)return!1;var t=!0;w=!1;try{o.writeByte(59),I=!0}catch(e){t=!1}return t},function(){i=0,s=null,l=null,c=null,f=null,I=!1,A=!0}),T=(u.setFrameRate=function(t){15!=t&&(m=Math.round(100/t))},u.setQuality=function(t){t<1&&(t=1),b=t},u.setGifSize=function(t,e){d=t,p=e},u.setSize=function(t,e){w&&!A||((a=t)<1&&(a=320),(n=e)<1&&(n=240),E=!0)}),B=(u.start=function(){N();var t=!0;I=!1,o=new r;try{o.writeUTFBytes("GIF89a")}catch(e){t=!1}return w=t},u.cont=function(){return N(),I=!1,o=new r,w=!0},function(t){var e=l.length,r=e/3;c=[];var a=new NeuQuant(l,e,b);f=a.process();for(var n=0,o=0;o<r;o++){var s=a.map(255&l[n++],255&l[n++],255&l[n++]);y[s]=!0,c[o]=s}if(l=null,h=8,C=7,null!=g){if(t){if(color=L(g),!color.success)return void(g=null);i=color.transIndex}else i=O(g);for(var u=f[3*i],d=f[3*i+1],p=f[3*i+2],v=[],m=0;m<f.length;m+=3)y[s=m/3]&&f[m]==u&&f[m+1]==d&&f[m+2]==p&&v.push(s);for(m=0;m<c.length;m++)v.indexOf(c[m])>=0&&(c[m]=i)}}),L=function(t){if(null===f)return-1;for(var e=(16711680&t)>>16,r=(65280&t)>>8,a=255&t,n=!1,i=45,o=f.length,s=0;s<o;){var l=e-(255&f[s++]),c=r-(255&f[s++]),h=a-(255&f[s]),u=Math.abs(l),d=Math.abs(c),p=Math.abs(h),g=u+d+p,v=parseInt(s/3);y[v]&&u<15&&d<15&&p<15&&g<i&&(i=g,n=v),s++}return!1===n?{success:!1}:{success:!0,transIndex:n}},O=function(t){if(null===f)return-1;for(var e=(16711680&t)>>16,r=(65280&t)>>8,a=255&t,n=0,i=16777216,o=f.length,s=0;s<o;){var l=e-(255&f[s++]),c=r-(255&f[s++]),h=a-(255&f[s]),u=l*l+c*c+h*h,d=parseInt(s/3);y[d]&&u<i&&(i=u,n=d),s++}return n},x=function(){var t=a,e=n;l=[];for(var r=s,i=0,o=0;o<e;o++)for(var c=0;c<t;c++){var h=o*t*4+4*c;l[i++]=r[h],l[i++]=r[h+1],l[i++]=r[h+2]}},F=function(){var t,e;o.writeByte(33),o.writeByte(249),o.writeByte(4),null===g?(t=0,e=0):(t=1,e=2),D>=0&&(e=7&D),e<<=2,o.writeByte(0|e|t),R(m),o.writeByte(i),o.writeByte(0)},G=function(){o.writeByte(33),o.writeByte(254),o.writeByte(S.length),o.writeUTFBytes(S),o.writeByte(0)},M=function(t,e){o.writeByte(44),R(t),R(e),R(a),R(n),A?o.writeByte(0):o.writeByte(128|C)},k=function(){null!==d&&null!==p?(R(d),R(p)):(R(a),R(n)),o.writeByte(240|C),o.writeByte(0),o.writeByte(0)},_=function(){o.writeByte(33),o.writeByte(255),o.writeByte(11),o.writeUTFBytes("NETSCAPE2.0"),o.writeByte(3),o.writeByte(1),R(v),o.writeByte(0)},P=function(){o.writeBytes(f);for(var t=768-f.length,e=0;e<t;e++)o.writeByte(0)},R=function(t){o.writeByte(255&t),o.writeByte(t>>8&255)},U=function(){new LZWEncoder(a,n,c,h).encode(o)};return u.stream=function(){return o},u.setProperties=function(t,e){w=t,A=e},u},e.changeGif=t=>{const r=e.dec,a=e.enc;function n(t){var e,r,a,n=t.r/t.a,i=t.g/t.a,o=t.b/t.a;return r=(.2126*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.7152*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.0722*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92))/1,a=(.0193*n+.1192*i+.9505*o)/1.08883,e=(e=(.4124*n+.3576*i+.1805*o)/.95047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(e-r),200*(r-(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116))]}function i(t,e){return 0==t.a&&0==e.a?0:0==t.a||0==e.a?1e3:function(t,e){var r=t[0]-e[0],a=t[1]-e[1],n=t[2]-e[2],i=Math.sqrt(t[1]*t[1]+t[2]*t[2]),o=i-Math.sqrt(e[1]*e[1]+e[2]*e[2]),s=a*a+n*n-o*o,l=r/1,c=o/(1+.045*i),h=(s=s<0?0:Math.sqrt(s))/(1+.015*i),f=l*l+c*c+h*h;return f<0?0:Math.sqrt(f)}(n(t),n(e))}r.load({files:[],buffers:[t.buffer],oncomplete:async e=>{const r=e[0].frames,n=r[0].imageDescriptor,o=n.width,s=n.height,l=a();t.repeat&&l.setRepeat(0),l.setQuality(t.quality),l.setGifSize(o,s),l.start();let c=0,h=0,f=0,u=!1;const d=t.optimize&&t.optimize.enable,p=t.skipFrame&&t.skipFrame.enable,g=t.brightnessFrame&&t.brightnessFrame.enable,v=t.sharpenFrame&&t.sharpenFrame.enable,m=[],w=document.createElement("canvas"),y=w.getContext("2d");if(d||p||g||v){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=o,t.height=s,e.drawImage(r[0].canvas,0,0);const a=e.getImageData(0,0,o,s);u=function(t){for(var e=0;e<t.data.length;e+=4)if(0==t.data[e+3])return!0;return!1}(a),w.width=o,w.height=s}r.forEach(((e,a)=>{const n=e.palette,w=e.indexData,C=e.graphicsControl.isTransparent,D=e.graphicsControl.transparencyIndex,I=e.imageDescriptor.x,A=e.imageDescriptor.y,E=10*e.graphicsControl.delay,b=e.graphicsControl.disposal,S=Math.max(15,t.percentSpeed?Math.round(E/t.percentSpeed):null);if(l.setDelay(t.percentSpeed?S:E),l.setDispose(b),d||p||v||g){if(p&&(++h,h-1>=t.skipFrame.skip)){const e=h-t.skipFrame.skip;if(e>=t.skipFrame.frameCount&&(h=0),a+1<r.length||e>1)return}if(g&&function(t,e,r,a,n,i){function o(t){return t<0?t=0:t>255&&(t=255),t}i=255*(parseFloat(i/100)-1);for(var s=t.getImageData(0,0,a,n),l=0,c=s.data;l<s.data.length;l+=4)c[l]=o(c[l]+i),c[l+1]=o(c[l+1]+i),c[l+2]=o(c[l+2]+i);t.putImageData(s,0,0)}(e.context,0,0,o,s,t.brightnessFrame.brightness),v&&function(t,e,r,a,n,i){i=parseFloat(i/100)-1;for(var o,s,l,c,h,f,u,d,p,g,v,m,w=[0,-1,0,-1,5,-1,0,-1,0],y=.5*(r=Math.round(Math.sqrt(w.length)))|0,C=t.createImageData(a,n),D=C.data,I=t.getImageData(0,0,a,n).data,A=n;A--;)for(o=a;o--;){for(s=A,e=o,f=4*(A*a+o),l=0,c=0,h=0,g=0;g<r;g++)for(p=0;p<r;p++)m=e+p-y,(v=s+g-y)>=0&&v<n&&m>=0&&m<a&&(d=w[g*r+p],l+=I[u=4*(v*a+m)]*d,c+=I[u+1]*d,h+=I[u+2]*d,I[u+3]);D[f]=l*i+I[f]*(1-i),D[f+1]=c*i+I[f+1]*(1-i),D[f+2]=h*i+I[f+2]*(1-i),D[f+3]=I[f+3]}t.putImageData(C,0,0)}(e.context,0,0,o,s,t.sharpenFrame.sharpen),d||u||2==c?(l.setTransparent(65535),y.fillStyle="cyan",y.fillRect(0,0,o,s)):l.setTransparent(null),d){const r=document.createElement("canvas"),a=r.getContext("2d");if(r.width=o,r.height=s,a.drawImage(e.canvas,0,0),f>0&&(f>0?c:1)<2){const e=document.createElement("canvas"),r=e.getContext("2d");e.width=o,e.height=s,r.drawImage(m[f-1].canvas,0,0),r.drawImage(m[f-1].optCanvas,0,0);const n=a.getImageData(0,0,o,s),l=r.getImageData(0,0,o,s);t.optimize.threshold>0&&function(t,e,r){for(var a=0;a<e.data.length;a+=4)i({r:e.data[a+0],g:e.data[a+1],b:e.data[a+2],a:e.data[a+3]},{r:t.data[a+0],g:t.data[a+1],b:t.data[a+2],a:t.data[a+3]})<=r&&(t.data[a+0]=0,t.data[a+1]=0,t.data[a+2]=0,t.data[a+3]=0)}(n,l,t.optimize.threshold),a.clearRect(0,0,o,s),a.putImageData(n,0,0)}m.push({canvas:e.canvas,optCanvas:r}),++f,y.drawImage(r,0,0)}else y.drawImage(e.canvas,0,0);c=b,l.addFrame(y,!1,!0)}else{const t=e.imageDescriptor.width,r=e.imageDescriptor.height;l.addFrameRaw(n,w,C,D,t,r,I,A)}})),l.finish(),t.oncomplete(l.toBlob())},onerror:t.onerror})},e};
